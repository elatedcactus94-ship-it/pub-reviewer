<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Nottingham Pub Ratings</title>
    <style>
      body { 
        font-family: 'Segoe UI', Roboto, Arial, sans-serif; 
        background-color: #F5F5F5;
        overflow: hidden;
        height: 100%;
        margin: 0;
      }

      #pubList {
        overflow-y: auto;
        height: 100%;
        padding: 20px;
        box-sizing: border-box;
      }

      /* Reviewer toggle */
      .reviewer-toggle { margin-bottom: 20px; display:flex; justify-content:center; }
      .toggle-switch {
        position: relative;
        width: 200px;
        height: 40px;
        background-color: #ddd;
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 5px;
      }
      .toggle-switch input { display: none; }
      .toggle-switch label {
        flex: 1;
        text-align: center;
        cursor: pointer;
        z-index: 3;
        font-weight: bold;
        line-height: 40px;
        color: #000; /* default text visible */
        transition: color 0.3s;
        user-select: none;
      }
      input#squeak:checked + label[for="squeak"], input#connor:checked + label[for="connor"] {
        color: #fff; /* text visible on colored slider */
      }

      .toggle-switch .slider {
        position: absolute;
        top: 0; left: 0;
        width: 50%;
        height: 100%;
        border-radius: 20px;
        transition: 0.3s;
        z-index: 2;
        background-color: #004080; 
      }
      input#connor:checked ~ .slider { background-color: #800000; left: 50%; }

      /* Pub cards */
      .pub-card { 
        border-radius: 10px; padding: 15px; margin-bottom: 10px; 
        cursor: pointer; transition: all 0.2s; border: 2px solid #ccc;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        position: relative;
        background-color: #fff;
      }
      .pub-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
      .pub-card.selected { border-width: 3px; }

      /* Reviewer card colors */
      .pub-card.squeak { background-color: #D0E4FF; border-color: #004080; }
      .pub-card.connor { background-color: #FFD0D0; border-color: #800000; }

      .reviewed-badge {
        position: absolute; top: 8px; right: 10px; background: green;
        color: white; font-size: 12px; padding: 2px 6px; border-radius: 10px;
      }

      .score-line { margin-top: 6px; font-weight: 600; }

      /* Questions container */
      .questions-container { margin-top: 10px; padding: 12px 16px; background: transparent; border-radius: 10px; }

      /* Question styling */
      .question { margin: 12px 0; }
      .question label { display: block; margin-bottom: 6px; font-weight: 500; }
      .question input[type=range] { width: 90%; height: 8px; border-radius: 5px; background: #ccc; appearance: none; }
      .question input[type=range]::-webkit-slider-thumb { appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #004080; cursor: pointer; transition: 0.3s; }
      input:focus, textarea:focus { outline: none; box-shadow: 0 0 3px #004080; }
      .question input[type=text], .question textarea { width: 90%; box-sizing: border-box; padding: 10px 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; transition: 0.2s; resize: vertical; background: #fff; }
      .question textarea { min-height: 72px; }
      .value-badge { margin-left: 10px; font-weight: 600; }

      .submit-btn { padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; border: none; margin-top: 10px; transition: 0.2s; }
      .submit-btn.squeak { background-color: #004080; color: white; }
      .submit-btn.squeak:hover { background-color: #0066cc; }
      .submit-btn.connor { background-color: #800000; color: white; }
      .submit-btn.connor:hover { background-color: #b30000; }

      .saved-message { margin-top: 10px; font-weight: bold; color: green; opacity: 0; transition: opacity 0.5s; }

      /* Leaderboard styles */
      #leaderboardBtn {
        position: fixed; bottom: 20px; right: 20px;
        background: #333; color: white; border: none; border-radius: 50%;
        width: 56px; height: 56px; font-size: 22px; display: flex; align-items: center; justify-content: center;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2); cursor: pointer; z-index: 1000; transition: background 0.3s ease;
      }
      #leaderboardBtn:hover { background: #555; }

      .modal-content { background: white; padding: 20px; border-radius: 12px; width: 90%; max-width: 400px; max-height: 80%; overflow-y: auto; }
      .leaderboard-item { display: flex; justify-content: space-between; padding: 8px 12px; border-radius: 6px; margin-bottom: 6px; color: black; font-weight: 500; }
      .leaderboard-item.gold { background-color: #FFD700; }
      .leaderboard-item.silver { background-color: #C0C0C0; }
      .leaderboard-item.bronze { background-color: #CD7F32; }
      .leaderboard-item.others { background-color: #eee; }
      .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); align-items: center; justify-content: center; z-index: 1000; }

      @media(max-width:480px) {
        .toggle-switch { width: 160px; height: 35px; }
        .toggle-switch label { line-height: 35px; font-size: 14px; }
        .pub-card { padding: 12px; }
        .submit-btn { font-size: 14px; padding: 8px 16px; }
      }
    </style>
  </head>
  <body>
    <!-- Reviewer toggle -->
    <div class="reviewer-toggle">
      <div class="toggle-switch">
        <input type="radio" id="squeak" name="reviewer" value="Squeak" checked onchange="changeReviewer()">
        <label for="squeak">Squeak</label>
        <input type="radio" id="connor" name="reviewer" value="Connor" onchange="changeReviewer()">
        <label for="connor">Connor</label>
        <div class="slider"></div>
      </div>
    </div>

    <!-- Pub cards -->
    <div id="pubList"></div>

    <!-- Leaderboard -->
    <button id="leaderboardBtn" onclick="showLeaderboard()">üèÜ</button>
    <div id="leaderboardModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeLeaderboard()" style="cursor:pointer; float:right; font-size:20px;">&times;</span>
        <h2>Leaderboard</h2>
        <div id="leaderboardList"></div>
      </div>
    </div>

    <script>
      const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwhPja-Er9ICDhwDTs_jy-u23HSLOateqttrhcQDgUYEVLBUHTfIljG2WO87P9TFZjrEA/exec';
      let pubData, selectedPub=null, reviewer='Squeak';

      async function init(){ pubData = await fetchPubData(); renderPubCards(); }
      async function fetchPubData(){ const resp = await fetch(WEB_APP_URL+'?action=getPubData'); return await resp.json(); }
      async function savePubRating(pubName, reviewer, answers){ await fetch(WEB_APP_URL+'?action=savePubRating',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({pubName,reviewer,answers})}); pubData = await fetchPubData(); renderPubCards(); }

      function changeReviewer(){ reviewer=document.querySelector('input[name="reviewer"]:checked').value; renderPubCards(); }

      function selectPub(index){ selectedPub=(selectedPub===index)?null:index; renderPubCards(); const card=document.querySelectorAll('.pub-card')[selectedPub]; if(card) card.scrollIntoView({behavior:'smooth', block:'start'}); }

      function closeLeaderboard(){ document.getElementById('leaderboardModal').style.display='none'; }
      document.getElementById('leaderboardModal').addEventListener('click', e=>{ if(e.target===e.currentTarget) closeLeaderboard(); });

      function adjustHeight(){ const h=window.innerHeight; document.body.style.height=h+'px'; document.getElementById('pubList').style.height=h+'px'; }
      window.addEventListener('load',()=>{ adjustHeight(); init(); });
      window.addEventListener('resize',adjustHeight);
    </script>
  </body>
</html>
